--Ejecutar dentro de sqlplus / as sysdba
ALTER session set "_ORACLE_SCRIPT"=true;
CREATE USER inventario IDENTIFIED BY DBFide1;

GRANT create session TO inventario;
GRANT create table TO inventario;
GRANT create view TO inventario;
GRANT create any trigger TO inventario;
GRANT create any procedure TO inventario;
GRANT create sequence TO inventario;
GRANT create synonym TO inventario;
GRANT create trigger TO inventario;

--Permisos para INSERT https://stackoverflow.com/a/21671145
ALTER USER inventario quota unlimited on USERS;

------------------------------------------------------------
-- Ejecutar en SQLDEVELOPER
-- Tabla "CATEGORÍAS"
CREATE TABLE CATEGORIAS (
ID_CATEGORIA INT PRIMARY KEY,
NOMBRE_CATEGORIA VARCHAR(100)
);

-- Tabla "ROLES"
CREATE TABLE ROLES (
ID_ROL INT PRIMARY KEY,
NOMBRE VARCHAR(100),
DESCRIPCION VARCHAR(200)
);

-- Tabla "PERMISOS"
CREATE TABLE PERMISOS (
ID_PERMISOS INT PRIMARY KEY,
NOMBRE VARCHAR(100),
ID_ROL INT,
DESCRIPCION VARCHAR(200),
FOREIGN KEY (ID_ROL) REFERENCES ROLES(ID_ROL)
);

-- Tabla "PROVEEDORES"
CREATE TABLE PROVEEDORES (
ID_PROVEEDOR INT PRIMARY KEY,
NOMBRE VARCHAR(100),
TELEFONO VARCHAR(20),
CORREO VARCHAR(100)
);

-- Tabla "ALMACENES"
CREATE TABLE ALMACENES (
ID_ALMACEN INT PRIMARY KEY,
NOMBRE_ALMACEN VARCHAR(100)
);

-- Tabla "EQUIPOS"
CREATE TABLE EQUIPOS (
ID_EQUIPO INT PRIMARY KEY,
NOMBRE_EQUIPO VARCHAR(100),
DESCRIPCION VARCHAR(200),
NUM_SERIE VARCHAR(50),
CANTIDAD_DISPONIBLE INT,
ID_CATEGORIA INT,
FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIAS(ID_CATEGORIA)
);

-- Tabla "DEPARTAMENTOS"
CREATE TABLE DEPARTAMENTOS (
ID_DEPARTAMENTO INT PRIMARY KEY,
NOMBRE_DEPARTAMENTO VARCHAR(100)
);

-- Tabla "PERSONAL"
CREATE TABLE PERSONAL (
ID_PERSONAL INT PRIMARY KEY,
NOMBRE VARCHAR(100),
TELEFONO VARCHAR(20),
CORREO VARCHAR(100),
ID_DEPARTAMENTO INT,
FOREIGN KEY (ID_DEPARTAMENTO) REFERENCES DEPARTAMENTOS(ID_DEPARTAMENTO)
);

-- Tabla "RECEPCIONES"
CREATE TABLE RECEPCIONES (
ID_RECEPCION INT PRIMARY KEY,
ID_EQUIPO INT,
ID_ALMACEN INT,
FECHA DATE,
HORA TIMESTAMP,
FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPOS(ID_EQUIPO),
FOREIGN KEY (ID_ALMACEN) REFERENCES ALMACENES(ID_ALMACEN)
);

-- Tabla "DESPACHOS"
CREATE TABLE DESPACHOS (
ID_DESPACHO INT PRIMARY KEY,
ID_EQUIPO INT,
ID_DEPARTAMENTO INT,
FECHA DATE,
HORA TIMESTAMP,
ID_PERSONAL INT,
FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPOS(ID_EQUIPO),
FOREIGN KEY (ID_DEPARTAMENTO) REFERENCES DEPARTAMENTOS(ID_DEPARTAMENTO),
FOREIGN KEY (ID_PERSONAL) REFERENCES PERSONAL(ID_PERSONAL)
);

-- Tabla "USUARIOS"
CREATE TABLE USUARIOS (
ID_USUARIOS INT PRIMARY KEY,
ID_PERSONAL INT,
USERNAME VARCHAR(100),
PASSWORD VARCHAR(100),
ID_ROL INT,
FOREIGN KEY (ID_PERSONAL) REFERENCES PERSONAL(ID_PERSONAL),
FOREIGN KEY (ID_ROL) REFERENCES ROLES(ID_ROL)
);

-- Tabla "COMPRAS"
CREATE TABLE COMPRAS (
    ID_COMPRA INT PRIMARY KEY,
    ID_PROVEEDOR INT,
    FECHA_COMPRA DATE
);

-- Tabla "DETALLE_COMPRAS"
CREATE TABLE DETALLE_COMPRAS (
    ID_DETALLE_COMPRA INT PRIMARY KEY,
    MATERIAL VARCHAR(100),
    CANTIDAD INT,
    PRECIO_UNITARIO DECIMAL(10,2),
    ID_COMPRA INT,
    FOREIGN KEY (ID_COMPRA) REFERENCES COMPRAS(ID_COMPRA)
);


--Obtener drop table de todas las tablas
SELECT 'DROP TABLE "' || TABLE_NAME || '" CASCADE CONSTRAINTS;' FROM user_tables;

DROP TABLE "CATEGORIAS" CASCADE CONSTRAINTS;
DROP TABLE "DEPARTAMENTOS" CASCADE CONSTRAINTS;
DROP TABLE "PERSONAL" CASCADE CONSTRAINTS;
DROP TABLE "ROLES" CASCADE CONSTRAINTS;
DROP TABLE "PERMISOS" CASCADE CONSTRAINTS;
DROP TABLE "PROVEEDORES" CASCADE CONSTRAINTS;
DROP TABLE "USUARIOS" CASCADE CONSTRAINTS;
DROP TABLE "EQUIPOS" CASCADE CONSTRAINTS;
DROP TABLE "DESPACHOS" CASCADE CONSTRAINTS;
DROP TABLE "ALMACENES" CASCADE CONSTRAINTS;
DROP TABLE "RECEPCIONES" CASCADE CONSTRAINTS;
DROP TABLE "DETALLE_COMPRAS" CASCADE CONSTRAINTS;
DROP TABLE "COMPRAS" CASCADE CONSTRAINTS;

--Eliminar todos los views
select 'drop view "'||view_name||'";' as statements from user_views;

drop view "VISTA_DETALLE_COMPRAS";
drop view "VISTA_COMPRAS";
drop view "VISTA_PROVEEDORES";
drop view "VISTA_CATEGORIAS";
drop view "VISTA_PERSONAL";
drop view "VISTA_ROLES";
drop view "VISTA_PERMISOS";
drop view "VISTA_RECEPCIONES";
drop view "VISTA_ALMACENES";
drop view "VISTA_DESPACHOS";
drop view "VISTA_EQUIPOS";
drop view "VISTA_DEPARTAMENTOS";
drop view "VISTA_USUARIOS";
